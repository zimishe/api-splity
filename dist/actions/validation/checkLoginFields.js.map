{"version":3,"sources":["../../../src/actions/validation/checkLoginFields.js"],"names":[],"mappings":";;;;;;;;;;;AAIO,SAAS,gBAAgB,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE;AAC5C,QAAI,MAAM,GAAG,EAAE;QACX,YAAY,GAAG;AACX,aAAK,EAAE,YAAY;AACnB,YAAI,EAAE,yBAAyB;KAClC;QACD,kBAAkB,GAAG;AACjB,aAAK,EAAE,eAAe;AACtB,YAAI,EAAE,oBAAoB;KAC7B,CAAC;;AAEN,QAAI,UAAU,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAK;AACtC,UAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CACjB,IAAI,CAAC;AACF,iBAAK,EAAE,IAAI,CAAC,UAAU;SACzB,CAAC,CACD,OAAO,CAAC,UAAC,GAAG,EAAE,OAAO,EAAK;;;;AAIvB,gBAAI,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;AACpB,sBAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AAC1B,uBAAO,EAAE,CAAC;aACb,MAAQ;AACL,AAAC,uBAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,IAAI,CAAC,aAAa,IAAK,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AAChF,uBAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;aACvB;SACJ,CAAC,CAAC;KACV,CAAC,CAAC;;AAEH,cAAU,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AAC1B,YAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AACnB,eAAG,CAAC,IAAI,CAAC,EAAC,MAAM,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,EAAC,CAAC,CAAA;SACxC,MAAQ;AACL,eAAG,CAAC,IAAI,CAAC;AACL,sBAAM,EAAE,CAAC;AACT,wBAAQ,EAAE,QAAQ;aACrB,CAAC,CAAA;SACL;KACJ,CAAC,CAAA;CACL","file":"checkLoginFields.js","sourcesContent":["/**\r\n * Created by eugene on 08/05/17.\r\n */\r\n\r\nexport function checkLoginFields(db, data, res) {\r\n    let errors = [],\r\n        noEmailError = {\r\n            field: 'user_email',\r\n            text: 'Email is not registered'\r\n        },\r\n        passwordMatchError = {\r\n            field: 'user_password',\r\n            text: \"Incorrect password\"\r\n        };\r\n\r\n    let checkEmail = new Promise((resolve) => {\r\n        db.collection('users')\r\n            .find({\r\n                email: data.user_email\r\n            })\r\n            .toArray((err, results) => {\r\n                // let foundNames = results.filter(result => result.name === data.user_name).length,\r\n                    // foundEmails = results.filter(result => result.email === data.user_email).length;\r\n                \r\n                if (results.length < 1) {\r\n                    errors.push(noEmailError);\r\n                    resolve();\r\n                }   else {\r\n                    (results[0].password !== data.user_password) && errors.push(passwordMatchError);\r\n                    resolve(results[0]);\r\n                }\r\n            });\r\n    });\r\n\r\n    checkEmail.then((userInfo) => {\r\n        if (errors.length > 0) {\r\n            res.json({status: 0, errors: errors})\r\n        }   else {\r\n            res.json({\r\n                status: 1,\r\n                userInfo: userInfo\r\n            })\r\n        }\r\n    })\r\n}"]}